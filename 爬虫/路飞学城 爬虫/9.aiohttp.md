# aiohttp

使用模块内的ClientSession对象

- resp.text() 获取字符串形式的响应数据
- resp.read() 获取二进制形式的响应数据
- resp.json() 返回json对象

```python
async with aiohttp.ClientSession() as session:
    async with session.get(url) as resp:
        # 容易漏掉await关键字
        html = await resp.text()
```

在获取html对象前需要使用await关键字，否则会出问题

发送post请求与上面一致，参数：

- headers 类似 requests
- params：参数
- data：表单数据
- proxy：`http://ip:port`

```python
import asyncio
import time
import aiohttp


async def get_html(url):
    print('get url: ', url)
    # 在异步协程中如果出现了同步模块相关的代码
    # r = requests.get(url)
    async with aiohttp.ClientSession() as session:
        async with session.get(url) as resp:
            html = await resp.text()
            
    print(html)
    return url

urls = [
    "http://127.0.0.1:5000/alice",
    "http://127.0.0.1:5000/tom",
    "http://127.0.0.1:5000/jack",
]

tasks = []
start = time.time()
for url in urls:
    c = get_html(url)
    task = asyncio.ensure_future(c)
    tasks.append(task)

loop = asyncio.get_event_loop()
loop.run_until_complete(asyncio.wait(tasks))
print("time %.2f" % (time.time() - start))
```

