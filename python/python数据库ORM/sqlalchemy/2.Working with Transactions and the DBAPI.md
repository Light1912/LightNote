在使用之前，为了查看数据库语句，可以先设置一下：

参考：https://docs.sqlalchemy.org/en/14/core/engines.html#dbengine-logging

```python
from sqlalchemy import text
from sqlalchemy import create_engine
import logging
logging.basicConfig(format="%(message)s",)
logger = logging.getLogger("sqlalchemy.engine")
logger.setLevel(logging.INFO)
# logger.getLogger("sqlalchemy.pool").setLevel(logging.DEBUG)

engine = create_engine('sqlite://', future=True)
with engine.connect() as conn:
    result = conn.execute(text("select 'hello world'"))
    # print(result.all())
```

```
BEGIN (implicit)
select 'hello world'
[generated in 0.00232s] ()
ROLLBACK
```

下面开始进行数据库操作

## 创建连接

首先是使用原始的数据库查询语句

```python
from sqlalchemy import text
with engine.connect() as conn:
    result = conn.execute(text("select 'hello world'"))
    print(result.all())
```

```
BEGIN (implicit)
select 'hello world'
[cached since 826.3s ago] ()
ROLLBACK

[('hello world',)]
```



这里有几个注意点：

- 这个事物并没有commit，需要调用conn.commit()提交给数据库
- result对象最好只在conn上下文块中使用

## committing changes

创建一张表，并往表里插两条数据，然后使用commit提交事务

```python
with engine.connect() as conn:
    conn.execute(text("CREATE TABLE some_table (x int, y int)"))
    conn.execute(
        text("INSERT INTO some_table (x, y) VALUES (:x, :y)"),
        [{"x": 1, "y": 1}, {"x": 2, "y": 4}]
    )
    conn.commit()
```

```
BEGIN (implicit)
CREATE TABLE some_table (x int, y int)
[generated in 0.00270s] ()
INSERT INTO some_table (x, y) VALUES (?, ?)
[generated in 0.00072s] ((1, 1), (2, 4))
COMMIT
```

