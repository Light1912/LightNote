根据状态转移矩阵求期望。状态转移矩阵如下：
$$
P = \left[ 
\begin{matrix}
p_{00} & p_{01} & p_{02} & p_{03} \\
p_{10} & p_{11} & p_{12} & p_{13} \\
p_{20} & p_{21} & p_{22} & p_{23} \\
p_{30} & p_{31} & p_{32} & p_{33} \\
\end{matrix}
\right]
$$
其中$p_{ij}$表示由状态$i$转移到状态$j$的概率，其中每行的概率和为1，即$\sum_{j=1}^{n}p_{ij}=1$

用$k_i$表示从状态$i$转移到最终状态，也就是状态3的期望次数

则可以列出公式
$$
\begin{aligned}
p_{00}(k_0+1)+p_{01}(k_1+1)+p_{02}(k_2+1)+p_{03} &= k_0 \\
p_{10}(k_0+1)+p_{11}(k_1+1)+p_{12}(k_2+1)+p_{13} &= k_1 \\
p_{20}(k_0+1)+p_{21}(k_1+1)+p_{22}(k_2+1)+p_{23} &= k_2 \\
p_{30}(k_0+1)+p_{31}(k_1+1)+p_{32}(k_2+1)+p_{33} &= k_3 \\
\end{aligned}
$$
右侧移动到左侧
$$
\begin{aligned}
k_0(p_{00} - 1) + k_1p_{01} + k_2p_{02} + 1 &= 0 \\
k_0p_{10} + k_1(p_{11}-1) + k_2p_{12}+ 1 &= 0 \\
k_0p_{20} + k_1p_{21} + k_2(p_{22}-1) + 1 &= 0 \\
k_0p_{30} + k_1p_{31} + k_2p_{32} -k_3+ 1 &= 0 \\
\end{aligned}
$$
化成矩阵形式
$$
\left[ 
\begin{matrix}
p_{00}-1 & p_{01} & p_{02} & 0\\
p_{10} & p_{11}-1 & p_{12} & 0\\
p_{20} & p_{21} & p_{22}-1 & 0\\
p_{30} & p_{31} & p_{32} & -1\\
\end{matrix}
\right]

\cdot

\left[ 
\begin{matrix}
k_0\\
k_1\\
k_2\\
k_3\\
\end{matrix}
\right]
=
\left[ 
\begin{matrix}
-1\\
-1\\
-1\\
-1\\
\end{matrix}
\right]
$$
然后左右两边的左侧同时乘以一个逆矩阵就求出了$k_i$

规律就是，砍掉$i=3$的行和$j=3$的列，剩下的主对角线-1。

> 如果要求所有状态转移到状态2的期望次数呢。
>
> 道理是相通的



想象这样一个情况，4个地点通过各个路线连接在一起，出发时是通过概率来选择去哪里的，问要走多少次才能回到原来的地方。

这道知乎题用我的方式解会十分简便

https://www.zhihu.com/question/447332111

difference equation

```
g(a, b) = 1/10 * (g(a-1, b) + 1) +
2/10 * (g(a, b-1) + 1) + 
7/10 * (g(a, b) + 1)
```

