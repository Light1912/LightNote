参考网址：

https://www.runoob.com/w3cnote/python-func-decorators.html

## 计算代码的执行时长

```python
import time

# time.time() 从1970-01-01 00:00:00 到现在的秒数
def mycode():
	res = 0
	for i in range(1000000):
		res = i * i - i
	return res

def get_time(func):
    start = time.time()
    func()
    print('time consume: %.4fs' % (time.time() - start))


get_time(mycode)
```

这个`get_time`函数就是装饰器的雏形



装饰器的写法

```python
import time

def get_time(func):
    def inner():
        start = time.time()
        func()
        print('time consume: %.4fs' % (time.time() - start))
    return inner

@get_time
def mycode():
    res = 0
    time.sleep(1)
    return res
# 相当于 mycode = get_time(mycode)
# 执行mycode想当于执行了inner()函数

mycode2 = get_time(mycode)
```



装饰器的返回值和参数

- 在inner函数里也要写上返回值
- 加上参数，标准写法如下

```python
import time
from functools import wraps

def get_time(func):
    @wraps(func)  # 使func.__name__正确
    def inner(a, b, c, *args, **kargs):
        start = time.time()
        res = func(a, b, c)
        print('time consume: %.4fs' % (time.time() - start))
        return res
    return inner

# @get_time 相当于使 mycode = get_time(mycode)
# 执行mycode想当于执行了inner()函数
@get_time
def mycode(a, b, c):
    time.sleep(1)
    return a + b + c


r = mycode(1, 2, 4)
print(r)

```

## 高级装饰器

```python
import time
   
def can_play(clock):
    print('can_play被调用了')
    
    def handle_action(func):
        print('handle_action被调用了')
        def do_action(name, game):
            if clock < 21:
                func(name, game)
            else:
                print('该睡觉了')
                
        return do_action
    return handle_action


# 相当于
# play_game = can_play(22)(play_game)
@can_play(22)
def play_game(name, game):
    print(name + '正在玩' + game)

play_game('alice', 'flappy bird')
```



使用场景

```python
# 用户权限
user_permission = 3  # 110 拥有读写权限

# 权限因子
READ_PERMISSION = 4  # 100
WRITE_PERMISSION = 2  # 010
EXE_PERMISSION = 1  # 001

# 可以发现 权限因子 & 用户权限 结果不为0，则说明拥有权限。
def check_permission(x, y):
    def handle_action(func):
        def do_action():
            if x & y != 0:
                func()
            else:
                print('没有相应的权限')
                
        return do_action
    return handle_action
    pass

@check_permission(user_permission, READ_PERMISSION)
def read():
    print('我在读取内容')

@check_permission(user_permission, WRITE_PERMISSION)
def write():
    print('我在写入内容')
    
@check_permission(user_permission, EXE_PERMISSION)
def execute():
    print('我在执行内容')

read()
write()
execute()
```

