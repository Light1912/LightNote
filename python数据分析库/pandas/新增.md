**pivot与unstack的用法**

这个挺全挺关键的

https://www.cnblogs.com/traditional/p/11967360.html

## series连续的True转换为范围

```python
labels = pd.Series([False, True, True, True, False, False, True, True])
labels_values = labels.values.astype(int).reshape(-1, 1)
mydiff = np.concatenate(
    [
        labels_values[0],
        np.diff(labels_values, axis=0).ravel(),
        0 - labels_values[-1]
    ]
)
starts = np.argwhere(mydiff==1).ravel()
ends = np.argwhere(mydiff==-1).ravel()

print(starts)
print(ends)
"""
[1 6]
[4 8]
"""
```

绘图

```python
fig, ax = plt.subplots()
for i, j in zip(starts, ends):
    ax.axvspan(i, j)
```

改进版:

原理：其实就是序列首位补0，然后一阶差分。

```python
labels = pd.Series([False, True, True, True, False, False, True, True])
labels_values = labels.values.astype(int).ravel()
v = np.concatenate([[0], labels_values, [0]])
mydiff = np.diff(v)
starts = np.argwhere(mydiff==1).ravel()
ends = np.argwhere(mydiff==-1).ravel()

print(starts)
print(ends)
"""
[1 6]
[4 8]
"""
```

函数化

```python
def get_span(s):    
    """ 
    提取连续的True的起始和结尾索引
    Parameters
    ----------
    s : pandas.Series
        bool类型的一维Series
    """
    s = s.values.astype(int).ravel()
    s = np.concatenate([[0], s, [0]])
    diff = np.diff(s)
    starts = np.argwhere(diff==1).ravel()
	ends = np.argwhere(diff==-1).ravel()
    return starts, ends
```





算法函数解决

```python
nums = [1,1,1,1]
nums.append(0)
prev = 0
ans = []
start = end = 0
for i, cur in enumerate(nums):
    diff = cur - prev
    if diff == 1:
        start = i
    elif diff == -1:
        end = i
        ans.append((s, e))
    prev = cur
    
print(ans)
```

